<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Who Let The Dog Out? üêï</title>
    <meta name="description" content="A fun detective mystery game - find out who let the dog out!">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            --secondary-gradient: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.25);
            --neon-purple: #a855f7;
            --neon-pink: #ec4899;
            --neon-blue: #3b82f6;
            --dark-bg: #0f0f1a;
            --card-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--dark-bg);
            min-height: 100vh;
            font-family: 'Nunito', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background:
                radial-gradient(circle at 20% 80%, rgba(120, 0, 255, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 0, 128, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(0, 200, 255, 0.2) 0%, transparent 40%),
                radial-gradient(circle at 60% 60%, rgba(255, 100, 0, 0.2) 0%, transparent 40%);
            animation: bgRotate 20s linear infinite;
        }

        @keyframes bgRotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* Floating Paw Prints */
        .floating-paws {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .paw {
            position: absolute;
            font-size: 2rem;
            opacity: 0.1;
            animation: floatPaw 15s ease-in-out infinite;
        }

        @keyframes floatPaw {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
                opacity: 0.1;
            }

            50% {
                transform: translateY(-100px) rotate(180deg);
                opacity: 0.3;
            }
        }

        /* Main Container - Glass Effect */
        .container {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2.5rem;
            max-width: 650px;
            width: 100%;
            box-shadow: var(--card-shadow);
            position: relative;
            z-index: 10;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        /* Title Styling */
        .title {
            font-family: 'Fredoka One', cursive;
            font-size: 2.2rem;
            text-align: center;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2rem;
            text-shadow: 0 0 40px rgba(167, 139, 250, 0.5);
            position: relative;
        }

        .title span {
            background: var(--secondary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .title-dog {
            display: inline-block;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-8px);
            }
        }

        /* Screens */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.98);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Labels & Inputs */
        label {
            display: block;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 0.5rem;
            margin-top: 1rem;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input[type="text"] {
            width: 100%;
            padding: 0.9rem 1.2rem;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }

        input[type="text"]::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--neon-purple);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.3);
        }

        /* Buttons */
        .btn {
            display: inline-block;
            background: var(--primary-gradient);
            color: white;
            padding: 1.1rem 2.5rem;
            border: none;
            border-radius: 14px;
            font-family: 'Fredoka One', cursive;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 2rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 35px rgba(168, 85, 247, 0.4);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: translateY(0) scale(0.98);
        }

        /* Story Box */
        .story {
            background: rgba(255, 255, 255, 0.08);
            padding: 2rem;
            border-radius: 16px;
            line-height: 1.9;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--neon-purple);
            font-size: 1.05rem;
        }

        .story p {
            margin-bottom: 0.8rem;
        }

        .story strong {
            color: var(--neon-pink);
            font-weight: 800;
        }

        .story em {
            color: var(--neon-blue);
        }

        /* Question Elements */
        .question-num {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 800;
            color: white;
            margin-bottom: 1.5rem;
            line-height: 1.4;
        }

        /* Clue & Twist Cards */
        .clue {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.1) 100%);
            padding: 1.2rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border-left: 4px solid #fbbf24;
            color: rgba(255, 255, 255, 0.9);
            font-style: italic;
            animation: slideIn 0.3s ease;
        }

        .twist {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.1) 100%);
            padding: 1.2rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border-left: 4px solid #ef4444;
            color: rgba(255, 255, 255, 0.95);
            font-weight: 700;
            animation: pulse 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }
        }

        /* Options */
        .options {
            display: flex;
            flex-direction: column;
            gap: 0.85rem;
        }

        .option {
            background: rgba(255, 255, 255, 0.08);
            padding: 1.2rem 1.5rem;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-gradient);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .option:hover {
            background: rgba(168, 85, 247, 0.2);
            border-color: var(--neon-purple);
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(168, 85, 247, 0.2);
        }

        .option:hover::before {
            opacity: 1;
        }

        /* Suspects Grid */
        .suspects-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.85rem;
            margin-top: 1.5rem;
        }

        .suspect-btn {
            background: rgba(255, 255, 255, 0.08);
            padding: 1.2rem;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            position: relative;
            overflow: hidden;
        }

        .suspect-btn:hover {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(248, 113, 113, 0.2) 100%);
            border-color: #ef4444;
            transform: scale(1.03);
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
        }

        .suspect-btn:nth-child(7) {
            grid-column: span 2;
        }

        /* Guesses Counter */
        .guesses-left {
            text-align: center;
            font-size: 1rem;
            color: #fbbf24;
            margin-bottom: 1rem;
            font-weight: 700;
            padding: 0.8rem;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 4px;
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.5);
        }

        /* Notebook */
        .notebook {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            padding: 1.2rem;
            margin-top: 1.5rem;
            max-height: 180px;
            overflow-y: auto;
        }

        .notebook::-webkit-scrollbar {
            width: 6px;
        }

        .notebook::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .notebook::-webkit-scrollbar-thumb {
            background: var(--neon-purple);
            border-radius: 3px;
        }

        .notebook-title {
            font-weight: 700;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .notebook-clue {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            padding: 0.4rem 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
        }

        /* Result Screen */
        .result {
            text-align: center;
            padding: 2rem 1rem;
        }

        .result-icon {
            font-size: 5rem;
            margin-bottom: 1.5rem;
            animation: iconPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes iconPop {
            0% {
                transform: scale(0);
            }

            80% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Dramatic Animations */
        @keyframes screenShake {

            0%,
            100% {
                transform: translateX(0);
            }

            10%,
            30%,
            50%,
            70%,
            90% {
                transform: translateX(-5px);
            }

            20%,
            40%,
            60%,
            80% {
                transform: translateX(5px);
            }
        }

        @keyframes dramaticFlash {
            0% {
                background: rgba(255, 255, 255, 0);
            }

            50% {
                background: rgba(255, 255, 255, 0.3);
            }

            100% {
                background: rgba(255, 255, 255, 0);
            }
        }

        @keyframes glitchReveal {
            0% {
                transform: skewX(0deg);
                filter: hue-rotate(0deg);
            }

            20% {
                transform: skewX(-5deg);
                filter: hue-rotate(90deg);
            }

            40% {
                transform: skewX(5deg);
                filter: hue-rotate(180deg);
            }

            60% {
                transform: skewX(-2deg);
                filter: hue-rotate(270deg);
            }

            80% {
                transform: skewX(2deg);
                filter: hue-rotate(360deg);
            }

            100% {
                transform: skewX(0deg);
                filter: hue-rotate(0deg);
            }
        }

        @keyframes pulseGlow {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(168, 85, 247, 0.5);
            }

            50% {
                box-shadow: 0 0 40px rgba(236, 72, 153, 0.8), 0 0 60px rgba(168, 85, 247, 0.6);
            }
        }

        @keyframes textReveal {
            0% {
                opacity: 0;
                transform: translateY(20px);
                filter: blur(10px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
                filter: blur(0);
            }
        }

        .shake {
            animation: screenShake 0.5s ease;
        }

        .flash {
            animation: dramaticFlash 0.3s ease;
        }

        .glitch {
            animation: glitchReveal 0.6s ease;
        }

        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }

        .text-reveal {
            animation: textReveal 0.8s ease forwards;
        }

        /* Twist card enhanced styling */
        .twist {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(220, 38, 38, 0.2) 100%);
            padding: 1.2rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border-left: 4px solid #ef4444;
            color: rgba(255, 255, 255, 0.95);
            font-weight: 700;
            animation: pulseGlow 2s infinite, textReveal 0.5s ease;
        }

        /* Evidence Image Styles */
        .evidence-image {
            width: 100%;
            max-width: 350px;
            height: auto;
            border-radius: 12px;
            border: 3px solid var(--neon-purple);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(168, 85, 247, 0.3);
            margin: 1rem auto;
            display: block;
            animation: textReveal 0.6s ease forwards;
        }

        .evidence-container {
            text-align: center;
            margin-bottom: 1rem;
        }

        .evidence-caption {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            margin-top: 0.5rem;
        }

        .story-image {
            width: 100%;
            max-width: 400px;
            height: auto;
            border-radius: 16px;
            border: 4px solid var(--neon-pink);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6), 0 0 30px rgba(236, 72, 153, 0.3);
            margin: 1.5rem auto;
            display: block;
            animation: textReveal 0.8s ease forwards;
        }

        .result-title {
            font-family: 'Fredoka One', cursive;
            font-size: 2rem;
            margin-bottom: 1.5rem;
        }

        .result-text {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .result-text strong {
            color: var(--neon-pink);
        }

        /* Wrong Guess */
        .wrong-guess {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.1) 100%);
            padding: 1.5rem;
            border-radius: 14px;
            text-align: center;
            margin-bottom: 1.5rem;
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
            animation: shake 0.5s ease;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            20%,
            60% {
                transform: translateX(-10px);
            }

            40%,
            80% {
                transform: translateX(10px);
            }
        }

        /* Audio Control */
        .audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            padding: 10px 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .audio-control:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }

        .audio-control .icon {
            font-size: 1.5rem;
            transition: transform 0.3s ease;
        }

        .audio-control:hover .icon {
            transform: scale(1.1);
        }

        .audio-control .label {
            color: white;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .audio-control.muted .icon {
            opacity: 0.5;
        }

        /* Volume Bars Animation */
        .volume-bars {
            display: flex;
            gap: 3px;
            align-items: flex-end;
            height: 20px;
        }

        .volume-bar {
            width: 4px;
            background: var(--neon-purple);
            border-radius: 2px;
            animation: volumeBar 0.8s ease-in-out infinite;
        }

        .volume-bar:nth-child(1) {
            height: 8px;
            animation-delay: 0s;
        }

        .volume-bar:nth-child(2) {
            height: 16px;
            animation-delay: 0.2s;
        }

        .volume-bar:nth-child(3) {
            height: 12px;
            animation-delay: 0.4s;
        }

        .volume-bar:nth-child(4) {
            height: 20px;
            animation-delay: 0.1s;
        }

        @keyframes volumeBar {

            0%,
            100% {
                transform: scaleY(1);
            }

            50% {
                transform: scaleY(0.5);
            }
        }

        .audio-control.muted .volume-bar {
            animation: none;
            height: 4px !important;
            opacity: 0.3;
        }

        /* YouTube Player (hidden) */
        #youtube-player {
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 1.5rem;
            }

            .title {
                font-size: 1.6rem;
            }

            .suspects-grid {
                grid-template-columns: 1fr;
            }

            .suspect-btn:nth-child(7) {
                grid-column: span 1;
            }

            .audio-control {
                top: 10px;
                right: 10px;
                padding: 8px 12px;
            }

            .audio-control .label {
                display: none;
            }
        }

        /* Suspects Input Grid */
        .suspects-input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }

        .suspects-input-grid input:nth-child(7) {
            grid-column: span 2;
        }

        @media (max-width: 500px) {
            .suspects-input-grid {
                grid-template-columns: 1fr;
            }

            .suspects-input-grid input:nth-child(7) {
                grid-column: span 1;
            }
        }
    </style>
</head>

<body>
    <!-- Animated Background -->
    <div class="bg-animation"></div>

    <!-- Floating Paw Prints -->
    <div class="floating-paws" id="floatingPaws"></div>

    <!-- Audio Control Toggle -->
    <div class="audio-control muted" id="audioControl" onclick="toggleAudio()">
        <div class="volume-bars">
            <div class="volume-bar"></div>
            <div class="volume-bar"></div>
            <div class="volume-bar"></div>
            <div class="volume-bar"></div>
        </div>
        <span class="icon">üîá</span>
        <span class="label">Music</span>
    </div>

    <!-- Hidden YouTube Player for Audio -->
    <div id="youtube-player"></div>

    <div class="container">

        <!-- LANDING SCREEN -->
        <div class="screen active" id="landing">
            <h1 class="title">Who Let The <span class="title-dog">üêï Dog</span> Out?</h1>

            <label>What's your name, detective?</label>
            <input type="text" id="detectiveName" placeholder="Detective...">

            <label>What's the dog's name?</label>
            <input type="text" id="dogName" placeholder="Tiny">

            <label>Name the 7 suspects:</label>
            <div class="suspects-input-grid">
                <input type="text" id="suspect1" placeholder="Mom">
                <input type="text" id="suspect2" placeholder="Dad">
                <input type="text" id="suspect3" placeholder="Brother">
                <input type="text" id="suspect4" placeholder="Sister">
                <input type="text" id="suspect5" placeholder="Neighbor">
                <input type="text" id="suspect6" placeholder="The Dog">
                <input type="text" id="suspect7" placeholder="A Stranger">
            </div>

            <button class="btn" onclick="startGame()">üîç START INVESTIGATION</button>
        </div>

        <!-- STORY SCREEN -->
        <div class="screen" id="storyScreen">
            <h1 class="title">Who Let <span id="dogNameTitle">Tiny</span> üêï Out?</h1>
            <div class="story" id="storyText"></div>
            <button class="btn" onclick="startQuestions()">üïµÔ∏è BEGIN INVESTIGATION</button>
        </div>

        <!-- QUESTION SCREEN -->
        <div class="screen" id="questionScreen">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="question-num" id="questionNum"></div>
            <div id="clueArea"></div>
            <div class="question-text" id="questionText"></div>
            <div class="options" id="optionsArea"></div>
            <div class="notebook" id="notebook" style="display:none;">
                <div class="notebook-title">üìì Detective's Notebook</div>
                <div id="notebookClues"></div>
            </div>
        </div>

        <!-- GUESS SCREEN -->
        <div class="screen" id="guessScreen">
            <h1 class="title">Make Your <span>Accusation</span> ‚öñÔ∏è</h1>
            <div class="guesses-left" id="guessesLeft"></div>
            <p style="text-align:center;margin-bottom:1rem;color:rgba(255,255,255,0.7);">Who let <span id="dogNameGuess"
                    style="color:#f472b6;font-weight:800;">Tiny</span> out?</p>
            <div class="suspects-grid" id="suspectsGrid"></div>
            <div class="notebook" id="notebookGuess">
                <div class="notebook-title">üìì Detective's Notebook</div>
                <div id="notebookCluesGuess"></div>
            </div>
        </div>

        <!-- WRONG GUESS SCREEN -->
        <div class="screen" id="wrongScreen">
            <div class="wrong-guess" id="wrongMessage"></div>
            <p style="text-align:center;color:rgba(255,255,255,0.7);margin-bottom:1rem;">Keep investigating...</p>
            <button class="btn" onclick="continueBonusQuestions()">üîç CONTINUE</button>
        </div>

        <!-- RESULT SCREEN -->
        <div class="screen" id="resultScreen">
            <div class="result">
                <div class="result-icon" id="resultIcon"></div>
                <div class="result-title" id="resultTitle"></div>
                <div class="result-text" id="resultText"></div>
                <button class="btn" onclick="location.reload()">üîÑ PLAY AGAIN</button>
            </div>
        </div>

    </div>

    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
        // ===== YOUTUBE AUDIO PLAYER =====
        let ytPlayer;
        let isMuted = true;

        function onYouTubeIframeAPIReady() {
            ytPlayer = new YT.Player('youtube-player', {
                height: '1',
                width: '1',
                videoId: 'OF2g4MhyU4s',
                playerVars: {
                    'autoplay': 1,
                    'loop': 1,
                    'playlist': 'OF2g4MhyU4s',
                    'controls': 0,
                    'showinfo': 0,
                    'modestbranding': 1,
                    'disablekb': 1,
                    'fs': 0,
                    'rel': 0
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            // Start muted
            event.target.mute();
            event.target.playVideo();
        }

        function onPlayerStateChange(event) {
            // Loop the video when it ends
            if (event.data === YT.PlayerState.ENDED) {
                ytPlayer.seekTo(0);
                ytPlayer.playVideo();
            }
        }

        function toggleAudio() {
            const control = document.getElementById('audioControl');
            const icon = control.querySelector('.icon');

            if (isMuted) {
                // Unmute
                if (ytPlayer && ytPlayer.unMute) {
                    ytPlayer.unMute();
                    ytPlayer.setVolume(50);
                    ytPlayer.playVideo();
                }
                isMuted = false;
                control.classList.remove('muted');
                icon.textContent = 'üîä';
            } else {
                // Mute
                if (ytPlayer && ytPlayer.mute) {
                    ytPlayer.mute();
                }
                isMuted = true;
                control.classList.add('muted');
                icon.textContent = 'üîá';
            }
        }

        // ===== FLOATING PAW PRINTS =====
        function createFloatingPaws() {
            const container = document.getElementById('floatingPaws');
            const pawEmojis = ['üêæ', 'üêï', 'ü¶¥', 'üê∂'];

            for (let i = 0; i < 15; i++) {
                const paw = document.createElement('div');
                paw.className = 'paw';
                paw.textContent = pawEmojis[Math.floor(Math.random() * pawEmojis.length)];
                paw.style.left = Math.random() * 100 + '%';
                paw.style.top = Math.random() * 100 + '%';
                paw.style.animationDelay = Math.random() * 15 + 's';
                paw.style.fontSize = (1.5 + Math.random() * 1.5) + 'rem';
                container.appendChild(paw);
            }
        }
        createFloatingPaws();

        // ===== SOUND EFFECTS (separate from music) =====
        const SFX = {
            twist: 'https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3',
            reveal: 'https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3',
            suspense: 'https://assets.mixkit.co/active_storage/sfx/209/209-preview.mp3',
            wrong: 'https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.mp3',
            correct: 'https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3',
            click: 'https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3'
        };

        function playSFX(type) {
            try {
                const audio = new Audio(SFX[type] || SFX.click);
                audio.volume = 0.4;
                audio.play().catch(() => { }); // Ignore autoplay errors
            } catch (e) { }
        }

        // ===== GAME STATE =====
        let detective = '';
        let dog = '';
        let suspects = [];
        let culprit = 0;
        let currentQuestion = 0;
        let guessesLeft = 2; // Reduced from 3 for more difficulty
        let cluesFound = [];
        let inBonusRound = false;
        let bonusQuestionsAsked = 0;
        let totalQuestionsAsked = 0;

        // Dynamic game elements
        let escapeTime = '';
        let escapeDay = '';
        let characterRoles = {};
        let storyVariant = 0;

        let questions = [];
        let bonusQuestions = [];

        function getVal(id, def) {
            const v = document.getElementById(id).value.trim();
            return v || def;
        }

        // Generate random escape time (never 3:47)
        function generateEscapeTime() {
            const hours = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
            const mins = [0, 5, 10, 15, 18, 22, 25, 28, 31, 33, 38, 41, 43, 52, 55, 58];
            // Exclude 3:47
            let h, m;
            do {
                h = hours[Math.floor(Math.random() * hours.length)];
                m = mins[Math.floor(Math.random() * mins.length)];
            } while (h === 3 && m === 47);

            const period = Math.random() > 0.3 ? 'PM' : 'AM';
            return `${h}:${m.toString().padStart(2, '0')} ${period}`;
        }

        // Generate random day
        function generateEscapeDay() {
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const modifiers = ['an ordinary', 'a perfectly normal', 'a seemingly quiet', 'an unremarkable', 'a lazy', 'a chaotic', 'a strange'];
            return `${modifiers[Math.floor(Math.random() * modifiers.length)]} ${days[Math.floor(Math.random() * days.length)]}`;
        }

        // Assign unique roles to each character
        function assignCharacterRoles() {
            const roles = [
                { type: 'liar', trait: 'keeps changing their story' },
                { type: 'nervous', trait: 'is sweating and avoiding eye contact' },
                { type: 'defensive', trait: 'gets angry when questioned' },
                { type: 'helpful', trait: 'is suspiciously eager to help' },
                { type: 'quiet', trait: 'has barely said a word all day' },
                { type: 'alibi', trait: 'has a perfect alibi... too perfect' },
                { type: 'accuser', trait: 'keeps pointing fingers at everyone else' }
            ];

            const shuffledRoles = [...roles].sort(() => Math.random() - 0.5);
            const shuffledIndices = [0, 1, 2, 3, 4, 5, 6].sort(() => Math.random() - 0.5);

            characterRoles = {};
            shuffledIndices.forEach((idx, i) => {
                characterRoles[idx] = shuffledRoles[i];
            });
        }

        // True random using crypto API when available
        function trueRandom(max) {
            if (window.crypto && window.crypto.getRandomValues) {
                const array = new Uint32Array(1);
                window.crypto.getRandomValues(array);
                return array[0] % max;
            }
            // Fallback with multiple random calls for better entropy
            return Math.floor((Math.random() + Math.random() + Math.random()) / 3 * max);
        }

        // Fisher-Yates shuffle for true randomness
        function fisherYatesShuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = trueRandom(i + 1);
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function startGame() {
            detective = getVal('detectiveName', 'Detective');
            dog = getVal('dogName', 'Tiny');

            // Pool of random default names - shuffled properly
            const namePool = fisherYatesShuffle([
                'Mom', 'Dad', 'Brother', 'Sister', 'Grandma', 'Grandpa', 'Uncle', 'Aunt',
                'The Neighbor', 'The Mailman', 'The Dog Walker', 'The Babysitter', 'The Gardener',
                'Best Friend', 'The Cousin', 'Roommate', 'The Chef', 'The Butler',
                'A Stranger', 'The Delivery Guy', 'The Handyman', 'The Pet Sitter',
                'The Teacher', 'The Coach', 'The Ex', 'The Boss', 'The Intern',
                'Karen', 'Kevin', 'Chad', 'Becky', 'Steve', 'Linda', 'Gary', 'Susan'
            ]);

            // Get all suspects with randomized defaults
            let tempSuspects = [
                getVal('suspect1', namePool[0]),
                getVal('suspect2', namePool[1]),
                getVal('suspect3', namePool[2]),
                getVal('suspect4', namePool[3]),
                getVal('suspect5', namePool[4]),
                getVal('suspect6', namePool[5]),
                getVal('suspect7', namePool[6])
            ];

            // Shuffle the suspects array with Fisher-Yates
            suspects = fisherYatesShuffle(tempSuspects);

            // Pick culprit using true random
            culprit = trueRandom(7);

            // Log for debugging (can remove later)
            console.log('Culprit index:', culprit, 'Name:', suspects[culprit]);

            escapeTime = generateEscapeTime();
            escapeDay = generateEscapeDay();
            storyVariant = trueRandom(5);
            assignCharacterRoles();

            generateQuestions();

            document.getElementById('dogNameTitle').textContent = dog;
            document.getElementById('storyText').innerHTML = generateStory();

            playSFX('suspense');
            showScreen('storyScreen');
        }

        function generateStory() {
            const s = suspects;
            const d = dog;
            const t = escapeTime;
            const day = escapeDay;

            // Random story opener
            const openers = [
                `<p>It was ${t} on ${day}. Nothing special. Nothing suspicious.</p>`,
                `<p>The clock struck ${t}. It was ${day}, and everything seemed fine.</p>`,
                `<p>${day}. ${t}. The moment everything changed.</p>`,
                `<p>Nobody saw it coming. ${t} on ${day}‚Äîthe calm before the storm.</p>`,
                `<p>If you asked anyone what they were doing at ${t} on ${day}, they'd all have an answer. But one of them is lying.</p>`
            ];

            // Random discovery scene
            const discoveries = [
                `<p>Then <strong>${s[Math.floor(Math.random() * 7)]}</strong> screamed.</p>
                 <p>The back door was open. The leash was on the floor. <strong>${d}</strong> was gone.</p>`,
                `<p><strong>${s[Math.floor(Math.random() * 7)]}</strong> noticed first. "${d}? <em>${d}?!</em>" The panic in their voice was real.</p>
                 <p>The gate was swinging in the wind. No ${d} in sight.</p>`,
                `<p>It was <strong>${s[Math.floor(Math.random() * 7)]}</strong> who found the empty collar by the fence.</p>
                 <p>"${d} is GONE!" The words echoed through the house.</p>`,
                `<p>The house went silent when <strong>${s[Math.floor(Math.random() * 7)]}</strong> checked ${d}'s usual spot.</p>
                 <p>Empty. The crate door was wide open. The back door... also open.</p>`,
                `<p>"Has anyone seen ${d}?" <strong>${s[Math.floor(Math.random() * 7)]}</strong> asked innocently enough.</p>
                 <p>Then the realization hit. The door. The empty yard. The missing dog.</p>`
            ];

            // Random character dynamics based on roles
            let dynamicsText = '<p>';
            Object.entries(characterRoles).forEach(([idx, role]) => {
                if (Math.random() > 0.6) {
                    dynamicsText += `${s[idx]} ${role.trait}. `;
                }
            });
            dynamicsText += '</p>';

            // Random twists in the setup
            const twists = [
                `<p>Strange thing is‚Äîthe security camera was conveniently "broken" since yesterday.</p>`,
                `<p>Even stranger: ${s[Math.floor(Math.random() * 7)]} was seen near the door just minutes before.</p>`,
                `<p>The weirdest part? ${d}'s treats are scattered in a trail leading outside. Someone lured them.</p>`,
                `<p>But here's the thing: THREE different people had access to that door. And they're all lying about something.</p>`,
                `<p>What nobody's talking about: there was an argument earlier. A loud one. About ${d}.</p>`
            ];

            const closers = [
                `<p><strong>Seven suspects. One dog. Zero reliable witnesses.</strong></p>
                 <p><em>${detective}, find out who let ${d} out.</em></p>`,
                `<p><strong>Everyone has a motive. Everyone has an alibi. Everyone is suspicious.</strong></p>
                 <p><em>Good luck, ${detective}. You'll need it.</em></p>`,
                `<p><strong>The truth is hiding in plain sight. But whose truth?</strong></p>
                 <p><em>${detective}, cut through the lies.</em></p>`
            ];

            // Story images
            const storyImage = '<img src="images/crime_scene.png" alt="The crime scene" class="story-image">';
            const posterImage = '<img src="images/missing_poster.png" alt="Missing dog poster" class="story-image">';

            return openers[trueRandom(openers.length)] +
                storyImage +
                discoveries[trueRandom(discoveries.length)] +
                dynamicsText +
                twists[trueRandom(twists.length)] +
                posterImage +
                closers[trueRandom(closers.length)];
        }

        function generateQuestions() {
            const s = suspects;
            const d = dog;

            // Create decoy suspects (not the real culprit) for misdirection
            const decoys = [0, 1, 2, 3, 4, 5, 6].filter(i => i !== culprit);
            const shuffle = arr => arr.sort(() => Math.random() - 0.5);
            shuffle(decoys);

            // All questions designed for maximum misdirection
            const allQuestions = [
                // ACT 1: THE SETUP - Everyone has motive
                {
                    q: `üîç You examine the back door. What catches your eye?`,
                    image: 'images/crime_scene.png',
                    options: [
                        { text: `Scratches on the handle`, clue: `Deep scratches... like someone was in a hurry. Or ${d} was trying to get back IN?` },
                        { text: `A partial footprint`, clue: `Too smudged to identify. Could be anyone. Could be everyone.` }
                    ]
                },
                {
                    q: `${s[decoys[0]]} approaches you nervously. "I need to tell you something..."`,
                    image: 'images/interrogation.png',
                    options: [
                        { text: `Listen closely`, clue: `"I... I saw ${s[decoys[1]]} near the door earlier. They looked suspicious." But ${s[decoys[0]]} won't make eye contact.` },
                        { text: `Ask why they're nervous`, clue: `${s[decoys[0]]} goes pale. "I'm not nervous! I just... I have allergies!" They clearly don't have allergies.` }
                    ]
                },
                {
                    q: `üö® TWIST: You find ${d}'s favorite toy hidden under a pillow in ${s[decoys[1]]}'s room!`,
                    options: [
                        { text: `Confront them immediately`, clue: `${s[decoys[1]]} panics: "I was hiding it so ${d} would come back for it!" ...Is that genius or insane?` },
                        { text: `Keep it secret for now`, clue: `You pocket the evidence. ${s[decoys[1]]} doesn't know you know. Yet.` }
                    ]
                },
                {
                    q: `${s[decoys[2]]} and ${s[decoys[3]]} are whispering in the corner. They stop when they see you.`,
                    options: [
                        { text: `Demand to know what they said`, clue: `They exchange a look. ${s[decoys[2]]}: "Nothing!" ${s[decoys[3]]}: "We were talking about the weather!" It's not raining.` },
                        { text: `Pretend you didn't notice`, clue: `You hear ${s[decoys[3]]} whisper: "...can't let them find out about the door..." WHAT DOOR?` }
                    ]
                },
                {
                    q: `You check phone records. Someone texted "is the coast clear?" at 3:42 PM.`,
                    options: [
                        { text: `Trace the number`, clue: `The number is... burner? No wait‚Äîit's ${s[decoys[4]]}'s old phone. Why do they have TWO phones?` },
                        { text: `Check who received it`, clue: `The message went to... a number not in anyone's contacts. A mystery accomplice?` }
                    ]
                },
                {
                    q: `üö® TWIST: ${s[decoys[0]]} suddenly "remembers" seeing ${d} outside at 3:30 PM!`,
                    options: [
                        { text: `But the escape was at 3:47...`, clue: `Exactly. Either ${s[decoys[0]]} is lying, confused, or... ${d} escaped TWICE?!` },
                        { text: `Ask for more details`, clue: `${s[decoys[0]]}'s story keeps changing. First it was by the fence. Then the garden. Now suddenly it was near ${s[decoys[5]]}'s car.` }
                    ]
                },
                {
                    q: `You find a torn piece of paper with handwriting: "Don't forget to‚Äî" The rest is missing.`,
                    image: 'images/torn_note.png',
                    options: [
                        { text: `Compare handwriting samples`, clue: `It matches ${s[decoys[2]]}'s handwriting! But they claim they've "never seen that paper before in their life."` },
                        { text: `Search for the other half`, clue: `You find it in the trash: "‚Äîlock the door after." WHO WROTE THIS?` }
                    ]
                },
                {
                    q: `${s[decoys[3]]} has mud on their shoes. Fresh mud.`,
                    image: 'images/paw_prints.png',
                    options: [
                        { text: `"Where were you?"`, clue: `"The garden!" But it hasn't rained in days. Where did the mud come from?` },
                        { text: `Check where the mud matches`, clue: `The mud matches the backyard... exactly where ${d} escaped from. Coincidence?` }
                    ]
                },
                // ACT 2: THE MISDIRECTION - Everything points wrong
                {
                    q: `üö® BOMBSHELL: Security footage shows someone at the door at 3:45 PM... but the face is obscured!`,
                    image: 'images/security_camera.png',
                    options: [
                        { text: `Analyze the clothing`, clue: `Blue hoodie. ${s[decoys[1]]}, ${s[decoys[4]]}, AND ${s[culprit]} all own blue hoodies. Dead end.` },
                        { text: `Check the height`, clue: `Medium height. That eliminates... nobody. Everyone in this house is medium height apparently.` }
                    ]
                },
                {
                    q: `${s[decoys[4]]} claims they were on a video call during the escape. Proof!`,
                    options: [
                        { text: `Verify the call`, clue: `The call log checks out... but wait. The call was on MUTE for 7 minutes around 3:47 PM. Suspicious gap.` },
                        { text: `Who were they calling?`, clue: `"My friend." The friend confirms. But the friend also pauses weirdly when you ask about the mute...` }
                    ]
                },
                {
                    q: `You find ${d}'s leash tangled in the fence. How?`,
                    options: [
                        { text: `${d} pulled free`, clue: `The clip is still closed. Someone UNHOOKED ${d}. This wasn't an accident.` },
                        { text: `Someone threw it there`, clue: `The angle is all wrong for ${d} running. Someone STAGED this.` }
                    ]
                },
                {
                    q: `üö® TWIST: THREE different people admit to opening the door "briefly" that afternoon!`,
                    options: [
                        { text: `Interview all three`, clue: `${s[decoys[0]]}: "Just for a package." ${s[decoys[2]]}: "To check the weather." ${s[decoys[5]]}: "I don't remember why." One of these is a LIE.` },
                        { text: `Check the timeline`, clue: `All three claim they closed it immediately. But ${d} got out somehow. Someone's not telling the whole truth.` }
                    ]
                },
                {
                    q: `${s[decoys[5]]}'s phone has a photo of ${d}... taken OUTSIDE the house at 3:52 PM.`,
                    options: [
                        { text: `"EXPLAIN THIS!"`, clue: `${s[decoys[5]]} breaks down: "I saw ${d} outside and tried to catch them! I didn't let them out, I SWEAR!"` },
                        { text: `Check for other photos`, clue: `There's a deleted photo of... the back door. Open. With someone's shadow in frame. But whose?` }
                    ]
                },
                {
                    q: `The treats bag has fingerprints from ${s[0]}, ${s[2]}, ${s[4]}, AND ${s[6]}.`,
                    options: [
                        { text: `Four suspects with access`, clue: `But wait‚Äî${s[1]}, ${s[3]}, and ${s[5]} could have used gloves. Everyone's still a suspect.` },
                        { text: `Who touched it LAST?`, clue: `The top layer of prints is too smudged. Useless. Someone was careful.` }
                    ]
                },
                // ACT 3: THE CHAOS - Nothing makes sense
                {
                    q: `üö® SHOCKING: ${s[decoys[1]]} accuses ${s[decoys[3]]} directly! "I SAW THEM DO IT!"`,
                    options: [
                        { text: `Believe them`, clue: `But ${s[decoys[3]]} has witnesses for their alibi... OR DO THEY? The witnesses are ${s[decoys[0]]} and ${s[decoys[2]]}. Everyone's covering for someone.` },
                        { text: `It's a deflection`, clue: `${s[decoys[1]]}'s accusation is suspiciously specific. How do they know so much unless THEY were there?` }
                    ]
                },
                {
                    q: `You find a SECOND route ${d} could have escaped‚Äîthe garage side door!`,
                    options: [
                        { text: `Check for evidence`, clue: `Paw prints near both doors. ${d} went to the back door, then the side door? Someone was CHASING them through the house!` },
                        { text: `Who has garage access?`, clue: `Only ${s[0]}, ${s[1]}, and ${s[6]} have keys. But the door wasn't locked...` }
                    ]
                },
                {
                    q: `${s[decoys[4]]} suddenly "finds" ${d}'s collar in their pocket!`,
                    options: [
                        { text: `"HOW did that get there?!"`, clue: `${s[decoys[4]]}: "Someone must have PLANTED IT!" They're either framed... or the worst liar ever.` },
                        { text: `Check for DNA`, clue: `The collar has ${d}'s fur (obviously) and... traces of hand lotion. ${s[decoys[4]]} doesn't use lotion. But ${s[decoys[2]]} does.` }
                    ]
                },
                {
                    q: `üö® CONFESSION: "${s[decoys[0]]}" breaks down crying! "IT WAS ME! I... wait, no. It wasn't. I'm so confused!"`,
                    options: [
                        { text: `They're covering for someone`, clue: `${s[decoys[0]]} keeps glancing at ${s[decoys[3]]}. Are they taking the fall for family?` },
                        { text: `The guilt is eating them`, clue: `But their confusion seems genuine. Maybe they SAW something and can't process it?` }
                    ]
                },
                {
                    q: `A neighbor's Ring camera caught audio: "Just go! Go! Before they see!" at 3:46 PM.`,
                    options: [
                        { text: `Voice analysis`, clue: `The audio quality is too poor. It could be anyone. It could be... ${d}? No, dogs can't talk. ...Can they?` },
                        { text: `Who was home?`, clue: `Everyone claims they were inside. But someone was at that door, and someone was TALKING TO ${d}.` }
                    ]
                },
                // ACT 4: THE REVELATION - Truth emerges
                {
                    q: `üö® BREAKTHROUGH: You realize the timeline everyone gave has a 3-minute gap. EVERYONE was unaccounted for at 3:46 PM!`,
                    options: [
                        { text: `Press each suspect`, clue: `Under pressure, stories crack. ${s[decoys[2]]} admits they were "in the bathroom." ${s[decoys[4]]} was "looking for their charger." Nobody can prove where they were.` },
                        { text: `Someone's lying`, clue: `In those 3 minutes, ${d} was let out. One person knows exactly what happened. The others are genuinely confused.` }
                    ]
                },
                {
                    q: `You notice ${s[culprit]} has been oddly... calm. Too calm.`,
                    options: [
                        { text: `Watch their body language`, clue: `While everyone else panics, ${s[culprit]} is measured. Composed. Like someone who knows exactly how this ends.` },
                        { text: `Could be innocent confidence`, clue: `Then again, truly innocent people are sometimes the calmest. Or is that just what they want you to think?` }
                    ]
                },
                {
                    q: `üö® THE REAL TWIST: ${d} RETURNED on their own... and went straight to ${s[culprit]}'s room!`,
                    options: [
                        { text: `${d} knows something`, clue: `Dogs don't lie. ${d} went right to the person they associate with... what? Guilt? Comfort? TREATS?` },
                        { text: `Could be coincidence`, clue: `But ${d} passed 6 other people and 5 other rooms. Something drew them there specifically.` }
                    ]
                },
                {
                    q: `One final piece: ${s[culprit]}'s alibi has ONE tiny inconsistency that nobody noticed...`,
                    options: [
                        { text: `They claimed to be upstairs‚Äîbut the floorboards never creaked`, clue: `You were in the kitchen at 3:46 PM. You would have heard. The floorboards ALWAYS creak. Unless ${s[culprit]} wasn't upstairs at all...` },
                        { text: `The TV show they claimed to watch aired at 4 PM, not 3:45 PM`, clue: `A 15-minute gap. Where were they really? By the back door, perhaps?` }
                    ]
                },
                {
                    q: `It's time. Based on the evidence‚Äîand the lies‚Äîyou must make your accusation.`,
                    options: [
                        { text: `"Gather everyone. It ends now."`, clue: `The room falls silent. All eyes on you. Think carefully, ${detective}. You only get one chance.` },
                        { text: `"I need to think this through..."`, clue: `Review everything. The confusing testimonies. The planted evidence. The ONE person whose story quietly unraveled. Trust your gut.` }
                    ]
                }
            ];

            // Shuffle questions but keep the last 4 (revelation questions) at the end
            const investigationQuestions = allQuestions.slice(0, -4);
            const revelationQuestions = allQuestions.slice(-4);
            shuffle(investigationQuestions);

            // Take 16 investigation questions + 4 revelation = 20 total
            questions = [...investigationQuestions.slice(0, 16), ...revelationQuestions];

            // Bonus questions are also mysterious, featuring false leads
            bonusQuestions = [
                {
                    q: `A new witness appears! The pizza delivery driver was here at 3:40 PM...`,
                    options: [
                        { text: `Interview them`, clue: `"I saw someone pacing by the back window. Looked stressed. Couldn't see their face though."` },
                        { text: `Check the receipt`, clue: `The pizza was ordered by... ${s[decoys[1]]}. But they claimed they "weren't hungry" that day.` }
                    ]
                },
                {
                    q: `üö® PLOT TWIST: ${s[decoys[3]]} reveals they have ${d} on a GPS tracker!`,
                    options: [
                        { text: `Check the route`, clue: `${d} went out the back, around the block, then... RETURNED before running off again? Someone brought ${d} back, then let them out AGAIN!` },
                        { text: `Why didn't they mention this before?!`, clue: `${s[decoys[3]]}'s excuse: "I forgot I had it..." WHO FORGETS A GPS TRACKER ON THEIR DOG?` }
                    ]
                },
                {
                    q: `The torn note's missing piece is found‚Äîin ${s[decoys[5]]}'s jacket pocket!`,
                    options: [
                        { text: `Confront them`, clue: `${s[decoys[5]]}: "I FOUND IT! I was going to tell you!" Classic. They all say that.` },
                        { text: `This could have been planted`, clue: `You're right to be suspicious. Multiple people had access to that jacket today.` }
                    ]
                },
                {
                    q: `${s[culprit]}'s browser history shows pet store searches... for "escape-proof harnesses."`,
                    options: [
                        { text: `They knew ${d} would run!`, clue: `Or... they were trying to PREVENT escapes. The search was from 2 weeks ago. Innocent or planning?` },
                        { text: `Anyone could have used their computer`, clue: `True. But the search was done at 2 AM. Who else would be awake?` }
                    ]
                },
                {
                    q: `üö® FINAL DISCOVERY: ${d}'s bark is caught on home assistant audio at exactly 3:46 PM. Someone says "Shhhh!"`,
                    options: [
                        { text: `Enhance the audio`, clue: `The "shhhh" is quiet, careful. Whoever it was KNEW they were doing something wrong.` },
                        { text: `${d} was trying to alert everyone`, clue: `${d} barked THREE TIMES. Three warnings. And someone silenced them each time.` }
                    ]
                }
            ];
        }

        function startQuestions() {
            currentQuestion = 0;
            showScreen('questionScreen');
            showQuestion();
        }

        function showQuestion() {
            const q = questions[currentQuestion];
            const total = inBonusRound ? 5 : 20;
            const current = inBonusRound ? bonusQuestionsAsked + 1 : currentQuestion + 1;

            document.getElementById('progressFill').style.width = `${(current / total) * 100}%`;
            document.getElementById('questionNum').textContent = inBonusRound ?
                `BONUS QUESTION ${bonusQuestionsAsked + 1}/5` :
                `QUESTION ${currentQuestion + 1}/20`;
            document.getElementById('questionText').textContent = q.q;

            // Show evidence image if available
            let imageHtml = '';
            if (q.image) {
                imageHtml = `<div class="evidence-container">
                    <img src="${q.image}" alt="Evidence" class="evidence-image">
                </div>`;
            }
            document.getElementById('clueArea').innerHTML = imageHtml;

            const optionsHtml = q.options.map((opt, i) =>
                `<div class="option" onclick="selectAnswer(${i})">${opt.text}</div>`
            ).join('');
            document.getElementById('optionsArea').innerHTML = optionsHtml;

            updateNotebook('notebook');
        }

        function selectAnswer(index) {
            const q = inBonusRound ? bonusQuestions[bonusQuestionsAsked] : questions[currentQuestion];
            const selected = q.options[index];

            // Check if this is a dramatic moment
            const isDramatic = q.q.includes('TWIST') || q.q.includes('BOMBSHELL') || q.q.includes('SHOCKING') || q.q.includes('CONFESSION') || q.q.includes('BREAKTHROUGH') || q.q.includes('FINAL');
            const clueClass = isDramatic ? 'twist' : 'clue';

            // Play appropriate sound effect
            if (isDramatic) {
                playSFX('twist');
                // Add screen shake for dramatic moments
                document.querySelector('.container').classList.add('shake');
                setTimeout(() => document.querySelector('.container').classList.remove('shake'), 500);
            } else {
                playSFX('reveal');
            }

            // Keep image if present, add clue below
            const existingImage = q.image ? `<div class="evidence-container">
                <img src="${q.image}" alt="Evidence" class="evidence-image">
            </div>` : '';
            document.getElementById('clueArea').innerHTML = existingImage + `<div class="${clueClass}">${selected.clue}</div>`;

            cluesFound.push(selected.clue);
            updateNotebook('notebook');

            document.querySelectorAll('.option').forEach(opt => {
                opt.style.pointerEvents = 'none';
                opt.style.opacity = '0.5';
            });
            document.querySelectorAll('.option')[index].style.opacity = '1';

            // Add Continue button instead of auto-advancing
            document.getElementById('optionsArea').innerHTML += `
                <button class="btn continue-btn" onclick="advanceQuestion()" style="margin-top: 1.5rem;">
                    ‚û°Ô∏è CONTINUE
                </button>
            `;
        }

        function advanceQuestion() {
            if (inBonusRound) {
                bonusQuestionsAsked++;
                if (bonusQuestionsAsked >= 5) {
                    inBonusRound = false;
                    bonusQuestionsAsked = 0;
                    showGuessScreen();
                } else {
                    showBonusQuestion();
                }
            } else {
                currentQuestion++;
                if (currentQuestion >= 20) {
                    showGuessScreen();
                } else {
                    showQuestion();
                }
            }
        }

        function showBonusQuestion() {
            const q = bonusQuestions[bonusQuestionsAsked];

            document.getElementById('progressFill').style.width = `${((bonusQuestionsAsked + 1) / 5) * 100}%`;
            document.getElementById('questionNum').textContent = `BONUS QUESTION ${bonusQuestionsAsked + 1}/5`;
            document.getElementById('questionText').textContent = q.q;
            document.getElementById('clueArea').innerHTML = '';

            const optionsHtml = q.options.map((opt, i) =>
                `<div class="option" onclick="selectAnswer(${i})">${opt.text}</div>`
            ).join('');
            document.getElementById('optionsArea').innerHTML = optionsHtml;

            updateNotebook('notebook');
            showScreen('questionScreen');
        }

        function showGuessScreen() {
            document.getElementById('dogNameGuess').textContent = dog;
            document.getElementById('guessesLeft').textContent = `‚ö†Ô∏è ${guessesLeft} guess${guessesLeft !== 1 ? 'es' : ''} remaining`;

            const grid = suspects.map((s, i) =>
                `<div class="suspect-btn" onclick="makeGuess(${i})">${s}</div>`
            ).join('');
            document.getElementById('suspectsGrid').innerHTML = grid;

            updateNotebook('notebookGuess');
            showScreen('guessScreen');
        }

        function updateNotebook(elementId) {
            const container = document.getElementById(elementId);
            const cluesContainer = document.getElementById(elementId === 'notebook' ? 'notebookClues' : 'notebookCluesGuess');

            if (cluesFound.length > 0) {
                container.style.display = 'block';
                cluesContainer.innerHTML = cluesFound.map(c =>
                    `<div class="notebook-clue">‚Ä¢ ${c.replace(/<[^>]*>/g, '')}</div>`
                ).join('');
            }
        }

        function makeGuess(index) {
            if (index === culprit) {
                playSFX('correct');
                showResult(true);
            } else {
                playSFX('wrong');
                // Shake on wrong guess
                document.querySelector('.container').classList.add('shake');
                setTimeout(() => document.querySelector('.container').classList.remove('shake'), 500);

                guessesLeft--;
                if (guessesLeft <= 0) {
                    showResult(false);
                } else {
                    document.getElementById('wrongMessage').innerHTML = `
                        ‚ùå It wasn't <strong>${suspects[index]}</strong>!<br>
                        ${guessesLeft} guess${guessesLeft !== 1 ? 'es' : ''} remaining.
                    `;
                    showScreen('wrongScreen');
                }
            }
        }

        function continueBonusQuestions() {
            inBonusRound = true;
            bonusQuestionsAsked = 0;
            showBonusQuestion();
        }

        function showResult(won) {
            const icon = won ? 'üéâ' : 'üò≠';
            const title = won ? `YOU SOLVED IT!` : `CASE CLOSED`;
            const text = won ?
                `Congratulations, ${detective}! You figured out that <strong>${suspects[culprit]}</strong> let ${dog} out!<br><br>${getMotiveText()}` :
                `The truth comes out: It was <strong>${suspects[culprit]}</strong> who let ${dog} out all along!<br><br>${getMotiveText()}`;

            document.getElementById('resultIcon').textContent = icon;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultTitle').style.color = won ? '#4ade80' : '#f87171';
            document.getElementById('resultText').innerHTML = text;

            // Dramatic reveal animation
            document.querySelector('.container').classList.add('glitch');
            setTimeout(() => document.querySelector('.container').classList.remove('glitch'), 600);

            showScreen('resultScreen');
        }

        function getMotiveText() {
            const motives = [
                `${suspects[culprit]} said: "I just wanted ${dog} to have some freedom! Is that so wrong?!"`,
                `${suspects[culprit]} confessed: "I was trying to give ${dog} a treat and the door slipped!"`,
                `${suspects[culprit]} admitted: "I was on my phone and didn't notice ${dog} run out..."`,
                `${suspects[culprit]} claimed: "It was an accident! ${dog} pushed past me!"`,
                `${suspects[culprit]} revealed: "${dog} gave me the puppy eyes. I couldn't say no."`,
                `${suspects[culprit]} explained: "I thought ${dog} would just stay in the yard!"`,
                `${suspects[culprit]} said: "Listen, ${dog} is very persuasive, okay?"`
            ];
            return motives[culprit];
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    </script>
</body>

</html>